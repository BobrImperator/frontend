<div class="dashboard-myreports" data-test-dashboard-myreports ...attributes>
  {{#unless loadAttr.isRunning}}
    <div class="dashboard-block-header">
      <h3 data-test-title>
        {{t "general.myReports"}}
      </h3>
      <div class="dashboard-block-actions">
        {{#if @selectedReport}}
          <button type="button" {{on "click" (action this.clearReport)}}>
            {{t "general.allReports"}}
          </button>
          <button
            type="button"
            disabled={{downloadReport.isRunning}}
            {{action (perform downloadReport)}}
          >
            {{#if finishedBuildingReport}}
              <FaIcon @icon="check" />
            {{else if downloadReport.isRunning}}
              <LoadingSpinner />
            {{else}}
              <FaIcon @icon="download" />
            {{/if}}
            {{t "general.downloadResults"}}
          </button>
        {{else}}
          <ExpandCollapseButton
            @value={{myReportEditorOn}}
            @action={{action "toggleEditor"}}
            @expandButtonLabel={{t "general.add"}}
            @collapseButtonLabel={{t "general.close"}}
          />
        {{/if}}
      </div>
    </div>
    {{#if @selectedReport}}
      <div
        class="dashboard-block-body"
        data-test-selected-report
        {{did-insert (set this.scrollTarget)}}
        {{! template-lint-disable no-invalid-interactive }}
        {{on "scroll" (action this.setScroll)}}
      >
        <h3 data-test-report-title>
          {{await selectedReportTitle}}
        </h3>
        {{#if showAcademicYearFilter}}
          <div class="years-filter">
            <select
              data-test-year-filter
              onchange={{action @onReportYearSelect value="target.value"}}
            >
              <option selected={{is-empty @selectedYear}} value="">
                {{t "general.allAcademicYears"}}
              </option>
              {{#each
                (sort-by
                  "academicYearTitle:desc" (await allAcademicYears)
                ) as |year|
              }}
                <option
                  value={{year.id}}
                  selected={{is-equal year.id @selectedYear}}
                >
                  {{year.academicYearTitle}}
                </option>
              {{/each}}
            </select>
          </div>
        {{/if}}
        {{#if (is-fulfilled reportResultsList)}}
          {{#if (get (await reportResultsList) "length")}}
            <ul data-test-results {{did-insert (action this.scrollDown)}}>
              {{#each (await reportResultsList) as |item|}}
                {{#if item.model2}}
                  <li>
                    <LinkTo
                      @route={{item.route}}
                      @models={{array item.model item.model2}}
                    >
                      {{item.value}}
                    </LinkTo>
                  </li>
                {{else if item.model}}
                  <li>
                    <LinkTo @route={{item.route}} @model={{item.model}}>
                      {{item.value}}
                    </LinkTo>
                  </li>
                {{else}}
                  <li>
                    {{item.value}}
                  </li>
                {{/if}}
              {{/each}}
            </ul>
          {{else}}
            {{t "general.none"}}
          {{/if}}
        {{else}}
          <LoadingSpinner @tagName="h1" />
        {{/if}}
      </div>
    {{else}}
      <div class="dashboard-block-body">
        {{#if myReportEditorOn}}
          <NewMyreport @close={{action "toggleEditor"}} />
        {{/if}}
        {{#if (is-fulfilled sortedReports)}}
          <ul class="saved-reports" data-test-saved-reports>
            {{#each (await sortedReports) as |report|}}
              <li>
                <MyreportsListItem
                  @report={{report}}
                  @onReportSelect={{@onReportSelect}}
                />
                <FaIcon
                  @icon="trash"
                  class="clickable remove enabled"
                  @click={{action "deleteReport" report}}
                />
              </li>
            {{else}}
              <li>
                {{t "general.none"}}
              </li>
            {{/each}}
          </ul>
        {{else}}
          <LoadingSpinner @tagName="h1" />
        {{/if}}
      </div>
    {{/if}}
  {{/unless}}
</div>
