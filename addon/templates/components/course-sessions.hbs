<div class="course-sessions-header">
  <div class="title">
    {{t "general.sessions"}} ({{this.sessionsCount}})
  </div>
  <div class="actions" data-test-actions>
    {{#if this.canCreateSession}}
      <ExpandCollapseButton
        @value={{this.showNewSessionForm}}
        @action={{toggle "showNewSessionForm" this}}
      />
    {{/if}}
    {{#if (and this.canUpdateCourse (gt this.sessionsCount 0))}}
      <LinkTo @route="course.publishall" @model={{this.course}}>
        <button>
          {{t "general.publishAllSessions" sessionCount=this.sessionsCount}}
        </button>
      </LinkTo>
    {{/if}}
  </div>
</div>
{{#if this.showNewSessionForm}}
  <div class="new-session-form">
    <NewSession
      @sessionTypes={{this.sessionTypes}}
      @save={{perform this.saveSession}}
      @cancel={{toggle "showNewSessionForm" this}}
    />
  </div>
{{/if}}
{{#if this.saveSession.lastSuccessful.value}}
  <div class="save-result" data-test-new-saved-session>
    <LinkTo
      @route="session.index"
      @models={{array this.course this.saveSession.lastSuccessful.value}}
    >
      <FaIcon @icon="external-link-square-alt" />
      {{get this.saveSession.lastSuccessful.value "title"}}
    </LinkTo>
    {{t "general.savedSuccessfully"}}
  </div>
{{/if}}
<div class="filter">
  <input
    value={{this.filterByDebounced}}
    oninput={{action (perform this.changeFilterBy) value="target.value"}}
    placeholder={{t "general.sessionTitleFilterPlaceholder"}}
    data-test-session-filter
  >
</div>
<section>
  <SessionsGridHeader
    @showExpandAll={{is-fulfilled this.sessionObjects}}
    @setSortBy={{this.setSortBy}}
    @sortBy={{this.sortBy}}
    @allSessionsExpanded={{and
      (eq
        this.expandedSessionIds.length (get (await this.sessionsWithOfferings) "length")
      )
      (gt (get (await this.sessionsWithOfferings) "length") 0)
    }}
    @toggleExpandAll={{perform this.toggleExpandAll}}
  />
  {{#if (is-fulfilled this.sessionObjects)}}
    <SessionsGrid
      @sessions={{await this.sessionObjects}}
      @sortBy={{this.sortBy}}
      @filterBy={{this.filterBy}}
      @expandedSessionIds={{this.expandedSessionIds}}
      @closeSession={{perform this.closeSession}}
      @expandSession={{perform this.expandSession}}
    />
  {{else}}
    <SessionsGridLoading @count={{has-many-length this.course "sessions"}} />
  {{/if}}
</section>
