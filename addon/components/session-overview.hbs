<div
  data-test-session-overview
  {{did-insert (perform this.load) @session @sessionTypes}}
  {{did-update (perform this.load) @session @sessionTypes}}
>
  {{#unless this.load.isRunning}}
    <div class="session-header">
      <span class="title">
        {{#if @editable}}
          <EditableField
            @value={{this.title}}
            @save={{fn this.changeTitle}}
            @close={{fn this.revertTitleChanges}}
            @saveOnEnter={{true}}
            @closeOnEscape={{true}} as |isSaving|
          >
            <Input
              type="text"
              @value={{this.title}}
              @key-press={{fn this.addErrorDisplayFor "title"}}
              disabled={{isSaving}}
            />
            {{#each (await (compute (fn this.getErrorsFor) "title")) as |message|}}
              <span class="validation-error-message">
                {{message}}
              </span>
            {{/each}}
          </EditableField>
        {{else}}
          <h3>{{@session.title}}</h3>
        {{/if}}
      </span>
      <span class="session-publication">
        {{#if @editable}}
          <Session::PublicationMenu @session={{@session}} @hideCheckLink={{@hideCheckLink}} />
        {{else}}
          <PublicationStatus @item={{@session}} />
        {{/if}}
      </span>
    </div>

    <section class="session-overview">
      <div class="last-update">
        {{fa-icon icon="history" title=(t "general.lastUpdate")}}
        {{t "general.lastUpdate"}}:
        {{this.updatedAt}}
      </div>

      <div class="session-overview-header">

        <div class="title">
          {{t "general.overview"}}
        </div>

        <div class="session-overview-actions">
          {{#if (and (is-fulfilled this.showCopy) (await this.showCopy))}}
            {{#link-to "session.copy" @session class="copy"}}
              {{fa-icon icon="copy" title=(t "general.copySession") fixedWidth=true}}
            {{/link-to}}
          {{/if}}
        </div>
      </div>

      <div class="session-overview-content">
        <div class="sessiontype block">
          <label>{{t "general.sessionType"}}:</label>
          <span>
            {{#if @editable}}
              <EditableField
                @value={{this.sessionType.title}}
                @save={{fn this.changeSessionType}}
                @close={{fn this.revertSessionTypeChanges}}
              >
                <select {{on "change" (action this.setSessionType value="target.value")}}>
                  {{#each this.sortedSessionTypes as |sessionType|}}
                    <option
                      value={{sessionType.id}}
                      selected={{eq sessionType.id this.sessionType.id}}
                    >
                      {{sessionType.title}}
                    </option>
                  {{/each}}
                </select>
              </EditableField>
              {{#unless this.sessionType.active}}
                <em>({{t "general.inactive"}})</em>
              {{/unless}}
            {{else}}
              {{@session.sessionType.title}}
              {{#unless this.sessionType.active}}
                <em>({{t "general.inactive"}})</em>
              {{/unless}}
            {{/if}}
          </span>
        </div>
        {{#if this.showSupplemental}}
          <div class="sessionsupplemental block">
            <label>{{t "general.supplementalCurriculum"}}:</label>
            <span>
              {{#if @editable}}
                <ToggleYesno @yes={{@session.supplemental}} @toggle={{this.changeSupplemental}}/>
              {{else}}
                {{#if @session.supplemental}}
                  <span class="add">{{t "general.yes"}}</span>
                {{else}}
                  <span class="remove">{{t "general.no"}}</span>
                {{/if}}
              {{/if}}
            </span>
          </div>
        {{/if}}
        {{#if this.showSpecialAttireRequired}}
          <div class="sessionspecialattire block">
            <label>{{t "general.specialAttireRequired"}}:</label>
            <span>
              {{#if @editable}}
                <ToggleYesno @yes={{@session.attireRequired}} @toggle={{this.changeSpecialAttire}}/>
              {{else}}
                {{#if @session.attireRequired}}
                  <span class="add">{{t "general.yes"}}</span>
                {{else}}
                  <span class="remove">{{t "general.no"}}</span>
                {{/if}}
              {{/if}}
            </span>
          </div>
        {{/if}}
        {{#if this.showSpecialEquipmentRequired}}
          <div class="sessionspecialequipment block">
            <label>{{t "general.specialEquipmentRequired"}}:</label>
            <span>
              {{#if @editable}}
                <ToggleYesno @yes={{@session.equipmentRequired}} @toggle={{this.changeSpecialEquipment}}/>
              {{else}}
                {{#if @session.equipmentRequired}}
                  <span class="add">{{t "general.yes"}}</span>
                {{else}}
                  <span class="remove">{{t "general.no"}}</span>
                {{/if}}
              {{/if}}
            </span>
          </div>
        {{/if}}
        {{#if this.showAttendanceRequired}}
          <div class="sessionattendancerequired block">
            <label>{{t "general.attendanceRequired"}}:</label>
            <span>
              {{#if @editable}}
                <ToggleYesno @yes={{@session.attendanceRequired}} @toggle={{this.changeAttendanceRequired}}/>
              {{else}}
                {{#if @session.attendanceRequired}}
                  <span class="add">{{t "general.yes"}}</span>
                {{else}}
                  <span class="remove">{{t "general.no"}}</span>
                {{/if}}
              {{/if}}
            </span>
          </div>
        {{/if}}
        <hr>
        <div class="independentlearningcontrol block">
          <label>{{t "general.independentLearning"}}:</label>
          <span class="independentlearningcontrol-value">
            {{#if @editable}}
              <ToggleYesno @yes={{this.isIndependentLearning}} @toggle={{perform this.saveIndependentLearning}} />
            {{else}}
              {{#if this.isIndependentLearning}}
                <span class="add">{{t "general.yes"}}</span>
              {{else}}
                <span class="remove">{{t "general.no"}}</span>
              {{/if}}
            {{/if}}
          </span>
        </div>
        {{#if this.isIndependentLearning}}
          <div class="sessionilmhours block">
            <label>{{t "general.hours"}}:</label>
            <span>
              {{#if @editable}}
                <EditableField
                    @value={{this.hours}}
                    @save={{fn this.changeIlmHours}}
                    @close={{fn this.revertIlmHoursChanges}}
                    @saveOnEnter={{true}}
                    @closeOnEscape={{true}} as |isSaving|
                >
                  <Input
                    type="text"
                    @value={{this.hours}}
                    @key-press={{fn this.addErrorDisplayFor "hours"}}
                    disabled={{isSaving}}
                  />
                  {{#each (await (compute (fn this.getErrorsFor) "hours")) as |message|}}
                    <span class="validation-error-message">
                      {{message}}
                    </span>
                  {{/each}}
                </EditableField>
              {{else}}
                {{@session.ilmSession.hours}}&nbsp;
              {{/if}}
            </span>
          </div>
          <div class="sessionilmduedate block {{if @session.hasPostrequisite "not-applicable"}}">
            <label>{{t "general.dueBy"}}:</label>
            <span>
              {{#if (is-fulfilled @session.ilmSession)}}
                {{#if @editable}}
                  <EditableField
                    @value={{moment-format @session.ilmSession.dueDate "L"}}
                    @save={{fn this.changeIlmDueDate}}
                    @close={{fn this.revertIlmDueDateChanges}}
                  >
                    <PikadayInput
                      @value={{this.dueDate}}
                      @format="L"
                      @onSelection={{fn (set this.dueDate)}}
                      @focusOut={{fn this.addErrorDisplayFor "dueDate"}}
                    />
                    {{#each (await (compute (fn this.getErrorsFor) "dueDate")) as |message|}}
                      <span class="validation-error-message">
                        {{message}}
                      </span>
                    {{/each}}
                  </EditableField>
                {{else}}
                  {{moment-format @session.ilmSession.dueDate "L"}}
                {{/if}}
              {{/if}}
            </span>
          </div>
        {{/if}}
        {{#if this.features.sessionLinkingAdminUi}}
          <div class="postrequisite block" data-test-postrequisite>
            {{#if @editable}}
              {{#if this.isEditingPostRequisite}}
                <Session::PostrequisiteEditor
                  @session={{@session}}
                  @close={{toggle "isEditingPostRequisite" this}}
                />
              {{else}}
                <label>
                  {{#if @session.hasPostrequisite}}
                    {{#link-to "session.index" (await @session.postrequisite.course) (await @session.postrequisite)}}
                      {{fa-icon  icon="external-link-square-alt"}} {{t "general.duePriorTo"}}:
                    {{/link-to}}
                  {{else}}
                    {{t "general.duePriorTo"}}:
                  {{/if}}
                </label>
                <button class="post-requisite-edit" {{on "click" (toggle "isEditingPostRequisite" this)}} data-test-edit>
                  {{#if @session.hasPostrequisite}}
                    {{@session.postrequisite.title}}
                  {{else}}
                    {{t "general.none"}}
                  {{/if}}
                </button>
              {{/if}}
            {{else}}
              <label>
                {{#if @session.hasPostrequisite}}
                  {{#link-to "session.index" (await @session.postrequisite.course) (await @session.postrequisite)}}
                    {{fa-icon  icon="external-link-square-alt"}} {{t "general.duePriorTo"}}:
                  {{/link-to}}
                {{else}}
                  {{t "general.duePriorTo"}}:
                {{/if}}
              </label>
              {{#if @session.hasPostrequisite}}
                {{@session.postrequisite.title}}
              {{else}}
                {{t "general.none"}}
              {{/if}}
            {{/if}}
          </div>
          <div class="prerequisites block">
            <label>{{t "general.prerequisites"}}:</label>
            {{#if @session.hasPrerequisites}}
              <span>
                {{#each (await @session.prerequisites) as |prerequisite|~}}{{#link-to "session.index" (await prerequisite.course) prerequisite}}{{fa-icon  icon="external-link-square-alt"}} {{prerequisite.title}}{{/link-to~}}{{#unless (eq prerequisite @session.prerequisites.lastObject)}}, {{/unless}}{{~/each}}
              </span>
            {{else}}
              {{t "general.none"}}
            {{/if}}
          </div>
        {{/if}}
        <hr>
        <div class="sessiondescription">
          <label>{{t "general.description"}}:</label>
          <span>
            {{#if @editable}}
              <EditableField
                @value={{this.description}}
                @renderHtml={{true}}
                @isSaveDisabled={{and
                  (v-get this "description" "isInvalid")
                  (contains "description" this.showErrorsFor)
                }}
                @save={{fn this.saveDescription}}
                @close={{perform this.revertDescriptionChanges}}
                @clickPrompt={{t "general.clickToEdit"}}

              >
                <HtmlEditor @content={{this.description}} @update={{fn this.changeDescription}} />
                {{#if (and (v-get this "description" "isInvalid") (contains "description" this.showErrorsFor))
                }}
                  <span class="validation-error-message">
                    {{v-get this "description" "message"}}
                  </span>
                {{/if}}
              </EditableField>
            {{else}}
              {{! template-lint-disable no-triple-curlies}}
              {{{this.description}}}
            {{/if}}
          </span>
        </div>
        <div class="instructional-notes" data-test-instructional-notes>
          <label>{{t "general.instructionalNotes"}}:</label>
          <span>
            {{#if @editable}}
              <EditableField
                @value={{@session.instructionalNotes}}
                @renderHtml={{true}}
                @isSaveDisabled={{and
                  (v-get this "instructionalNotes" "isInvalid")
                  (contains "instructionalNotes" this.showErrorsFor)
                }}
                @save={{perform this.saveInstructionalNotes}}
                @close={{fn this.revertInstructionalNotesChanges}}
                @clickPrompt={{t "general.clickToEdit"}}

              >
                <HtmlEditor @content={{this.instructionalNotes}} @update={{fn this.changeInstructionalNotes}} />
                {{#if (and (v-get this "instructionalNotes" "isInvalid") (contains "instructionalNotes" this.showErrorsFor))
                }}
                  <span class="validation-error-message">
                    {{v-get this "instructionalNotes" "message"}}
                  </span>
                {{/if}}
              </EditableField>
            {{else}}
              {{! template-lint-disable no-triple-curlies}}
              {{{this.instructionalNotes}}}
            {{/if}}
          </span>
        </div>
        {{#unless this.isIndependentLearning}}
          <br>
          <div class="sessionassociatedgroups">
            <label>{{t "general.associatedGroups"}}:</label>
            <span>
              {{#if (is-fulfilled @session.associatedOfferingLearnerGroups)}}
                <span>
                  {{#each (await @session.associatedOfferingLearnerGroups) as |group|}}
                    {{group.title}},
                  {{else}}
                    {{t "general.none"}}
                  {{/each}}
                </span>
              {{else}}
                <LoadingPart />
              {{/if}}
            </span>
          </div>
        {{/unless}}
      </div>
    </section>
  {{/unless}}
</div>
