<section class="calendar-controls">
  <div class="calendar-options-control togglemyschedule">
    <ToggleButtons
      @firstOptionSelected={{this.mySchedule}}
      @firstLabel={{t "general.mySchedule"}}
      @secondLabel={{t "general.allEvents"}}
      @toggle={{this.toggleMySchedule}}
    />
  </div>
  <div class="calendar-options-control showfilters">
    <ToggleButtons
      @firstOptionSelected={{not this.showFilters}}
      @firstLabel={{t "general.hideFilters"}}
      @secondLabel={{t "general.showFilters"}}
      @toggle={{this.toggleShowFilters}}
    />
  </div>
  {{#if this.showFilters}}
    <div class="calendar-options-control togglecoursefilters">
      <ToggleButtons
        @firstOptionSelected={{this.courseFilters}}
        @firstLabel={{t "general.courseOrType"}}
        @secondLabel={{t "general.detail"}}
        @toggle={{this.toggleCourseFilters}}
      />
    </div>
    {{#if this.showClearFilters}}
      <span
        id="calendar-clear-filters"
        class="calendar-clear-filters"
        role="button"
        {{action this.onClearFilters}}
      >
        {{t "general.clearFilters"}}
      </span>
    {{/if}}
  {{/if}}
  {{#unless this.mySchedule}}
    <div class="calendar-options-control calendar-school-picker">
      <FaIcon @icon="university" />
      {{#if (await this.hasMoreThanOneSchool)}}
        <select onchange={{action this.changeSchool value="target.value"}}>
          {{#each (sort-by "title" (await this.allSchools)) as |school|}}
            <option
              value={{school.id}}
              selected={{is-equal school (await this.bestSelectedSchool)}}
            >
              {{school.title}}
            </option>
          {{/each}}
        </select>
      {{else}}
        {{get (await this.bestSelectedSchool) "title"}}
      {{/if}}
    </div>
  {{/unless}}
  {{#if this.showFilters}}
    <div
      id="calendar-year-picker"
      class="calendar-options-control calendar-year-picker"
    >
      <select onchange={{action this.changeAcademicYear value="target.value"}}>
        {{#each (await this.academicYears) as |year|}}
          <option
            value={{year.title}}
            selected={{is-equal year (await this.bestSelectedAcademicYear)}}
          >
            {{year.academicYearTitle}}
          </option>
        {{/each}}
      </select>
    </div>
  {{/if}}
  <div class="calendar-filters">
    {{#liquid-if this.showFilters class="vertical"}}
      {{#liquid-if this.courseFilters class="crossFade"}}
        <div
          id="calendar-coursefilter"
          class="calendar-filter-list large-filter-list coursefilter"
        >
          <h5>
            {{get (await this.bestSelectedAcademicYear) "academicYearTitle"}}
            {{t "general.courses"}}
          </h5>
          {{#if (is-fulfilled this.courses)}}
            <ul>
              {{#each (await this.courses) as |course|}}
                <li class="clickable">
                  <input
                    class="checkbox"
                    type="checkbox"
                    checked={{is-in (await this.selectedCourses) course}}
                    {{action this.onUpdateCourses course.id on="change"}}
                  >
                  <span
                    class="list-indentation"
                    role="button"
                    {{action this.onUpdateCourses course.id}}
                  >
                    {{course.title}}
                    {{#if course.externalId}}
                      ({{course.externalId}})
                    {{/if}}
                  </span>
                </li>
              {{/each}}
            </ul>
          {{else}}
            <FaIcon @icon="spinner" @spin={{true}} />
          {{/if}}
        </div>
        <div
          id="calendar-sessiontypefilter"
          class="calendar-filter-list sessiontypefilter"
        >
          <h5>
            {{t "general.sessionTypes"}}
          </h5>
          {{#if (is-fulfilled this.sessionTypes)}}
            <ul>
              {{#each (await this.sessionTypes) as |type|}}
                <li class="clickable">
                  <input
                    checked={{is-in (await this.selectedSessionTypes) type}}
                    class="checkbox"
                    type="checkbox"
                    {{action this.onUpdateSessionTypes type.id on="change"}}
                  >
                  <span
                    class="list-indentation"
                    role="button"
                    {{action this.onUpdateSessionTypes type.id}}
                  >
                    {{type.title}}
                  </span>
                </li>
              {{/each}}
            </ul>
          {{else}}
            <FaIcon @icon="spinner" @spin={{true}} />
          {{/if}}
        </div>
        <div class="calendar-filter-list vocabularyfilter">
          <h5>
            {{t "general.terms"}}
          </h5>
          {{#if (is-fulfilled this.vocabularies)}}
            <ul>
              {{#each (await this.vocabularies) as |vocabulary|}}
                <h6>
                  {{vocabulary.title}}
                </h6>
                <SelectedTermTree
                  @selectedTerms={{await this.selectedTerms}}
                  @terms={{await vocabulary.topLevelTerms}}
                  @toggle={{action this.onUpdateTerms}}
                />
              {{/each}}
            </ul>
          {{else}}
            <FaIcon @icon="spinner" @spin={{true}} />
          {{/if}}
        </div>
      {{else}}
        <div
          id="calendar-sessiontypefilter"
          class="calendar-filter-list sessiontypefilter"
        >
          <h5>
            {{t "general.sessionTypes"}}
          </h5>
          {{#if (is-fulfilled this.sessionTypes)}}
            <ul>
              {{#each (await this.sessionTypes) as |type|}}
                <li class="clickable">
                  <input
                    class="checkbox"
                    type="checkbox"
                    checked={{is-in (await this.selectedSessionTypes) type}}
                    {{action this.onUpdateSessionTypes type.id on="change"}}
                  >
                  <span
                    class="list-indentation"
                    role="button"
                    {{action this.onUpdateSessionTypes type.id}}
                  >
                    {{type.title}}
                  </span>
                </li>
              {{/each}}
            </ul>
          {{else}}
            <FaIcon @icon="spinner" @spin={{true}} />
          {{/if}}
        </div>
        <div
          id="calendar-courselevelfilter"
          class="calendar-filter-list small-filter-list courselevelfilter"
        >
          <h5>
            {{t "general.courseLevels"}}
          </h5>
          <ul>
            {{#each this.courseLevels as |level|}}
              <li class="clickable">
                <input
                  class="checkbox"
                  type="checkbox"
                  checked={{contains level this.selectedCourseLevels}}
                  {{action this.onUpdateCourseLevels level on="change"}}
                >
                <span
                  class="list-indentation"
                  role="button"
                  {{action this.onUpdateCourseLevels level}}
                >
                  {{level}}
                </span>
              </li>
            {{/each}}
          </ul>
        </div>
        <div
          id="calendar-cohortfilter"
          class="calendar-filter-list large-filter-list cohortfilter"
        >
          <h5>
            {{get (await this.bestSelectedAcademicYear) "academicYearTitle"}}
            {{t "general.programAndCohort"}}
          </h5>
          {{#if (is-fulfilled this.cohorts)}}
            <ul>
              {{#each (await this.cohorts) as |cohort|}}
                <li class="clickable">
                  <input
                    class="checkbox"
                    type="checkbox"
                    checked={{is-in (await this.selectedCohorts) cohort}}
                    {{action this.onUpdateCohorts cohort.id on="change"}}
                  >
                  <span
                    class="list-indentation"
                    role="button"
                    {{action this.onUpdateCohorts cohort.id}}
                  >
                    {{#if cohort.title}}
                      {{cohort.title}}
                    {{else}}
                      {{t "general.classOf" year=(await cohort.classOfYear)}}
                    {{/if}}
                    {{get (await cohort.programYear.program) "title"}}
                  </span>
                </li>
              {{/each}}
            </ul>
          {{else}}
            <FaIcon @icon="spinner" @spin={{true}} />
          {{/if}}
        </div>
      {{/liquid-if}}
    {{/liquid-if}}
  </div>
</section>
{{#if (gt (get (await this.activeFilters) "length") 0)}}
  <section class="filters-list">
    <header class="filters-header">
      {{t "general.activeFilters"}}:
    </header>
    <div class="filter-tags">
      {{#each (await this.filterTags) as |tag|}}
        <span
          class="filter-tag {{tag.class}}"
          role="button"
          {{action "removeFilter" tag.filter}}
        >
          {{tag.name}}
          <FaIcon @icon="times" />
        </span>
      {{/each}}
      <span
        id="calendar-clear-filters"
        class="filters-clear-filters"
        role="button"
        {{action this.onClearFilters}}
      >
        {{t "general.clearFilters"}}
      </span>
    </div>
  </section>
{{/if}}
<section class="fullwidth ilios-calendar-container">
  <IliosCalendar
    @calendarEventsPromise={{this.filteredEvents}}
    @selectedDate={{this.calendarDate}}
    @selectedView={{this.selectedView}}
    @changeDate={{this.changeDate}}
    @changeView={{this.changeView}}
    @selectEvent={{this.selectEvent}}
    @icsFeedUrl={{await this.absoluteIcsUri}}
    @icsInstructions={{this.icsInstructionsTranslation}}
  />
</section>
