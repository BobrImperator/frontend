<div class="course-sessions-header">
  <div class="title">
    {{t "general.sessions"}} ({{sessionsCount}})
  </div>
  <div class="actions" data-test-actions>
    {{#if canCreateSession}}
      <ExpandCollapseButton
        @value={{showNewSessionForm}}
        @action={{toggle "showNewSessionForm" this}}
      />
    {{/if}}
    {{#if (and canUpdateCourse (gt sessionsCount 0))}}
      <LinkTo @route="course.publishall" @model={{course}}>
        <button>
          {{t "general.publishAllSessions" sessionCount=sessionsCount}}
        </button>
      </LinkTo>
    {{/if}}
  </div>
</div>
{{#if showNewSessionForm}}
  <div class="new-session-form">
    <NewSession
      @sessionTypes={{sessionTypes}}
      @save={{perform saveSession}}
      @cancel={{toggle "showNewSessionForm" this}}
    />
  </div>
{{/if}}
{{#if saveSession.lastSuccessful.value}}
  <div class="save-result" data-test-new-saved-session>
    <LinkTo
      @route="session.index"
      @models={{array course saveSession.lastSuccessful.value}}
    >
      <FaIcon @icon="external-link-square-alt" />
      {{get saveSession.lastSuccessful.value "title"}}
    </LinkTo>
    {{t "general.savedSuccessfully"}}
  </div>
{{/if}}
<div class="filter">
  <input
    value={{filterByDebounced}}
    oninput={{action (perform changeFilterBy) value="target.value"}}
    placeholder={{t "general.sessionTitleFilterPlaceholder"}}
    data-test-session-filter
  >
</div>
<section>
  <SessionsGridHeader
    @showExpandAll={{is-fulfilled sessionObjects}}
    @setSortBy={{setSortBy}}
    @sortBy={{sortBy}}
    @allSessionsExpanded={{and
      (eq
        expandedSessionIds.length (get (await sessionsWithOfferings) "length")
      )
      (gt (get (await sessionsWithOfferings) "length") 0)
    }}
    @toggleExpandAll={{perform toggleExpandAll}}
  />
  {{#if (is-fulfilled sessionObjects)}}
    <SessionsGrid
      @sessions={{await sessionObjects}}
      @sortBy={{sortBy}}
      @filterBy={{filterBy}}
      @expandedSessionIds={{expandedSessionIds}}
      @closeSession={{perform closeSession}}
      @expandSession={{perform expandSession}}
    />
  {{else}}
    <SessionsGridLoading @count={{has-many-length course "sessions"}} />
  {{/if}}
</section>

