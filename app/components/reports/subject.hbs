<section
  class="reports-subject"
  data-test-reports-subject
  ...attributes
>
  <div class="back-to-reports" data-test-back-to-reports>
    <LinkTo @route="reports">
      {{t "general.backToReports"}}
    </LinkTo>
  </div>
  <div class="header" data-test-report-header>
    <h2 class="title" data-test-report-title>
      {{#if this.constructedReportTitleLoaded}}
        <EditableField
          data-test-title
          @value={{this.reportTitle}}
          @save={{perform this.changeTitle}}
          @close={{this.revertTitleChanges}}
          @saveOnEnter={{true}}
          @showIcon={{true}}
          @closeOnEscape={{true}} as |isSaving|
        >
          <input
            aria-label={{t "general.reportTitle"}}
            type="text"
            value={{this.reportTitle}}
            placeholder={{this.constructedReportTitle}}
            disabled={{isSaving}}
            {{on "input" (pick "target.value" (set this.title))}}
            {{on "keyup" (fn this.addErrorDisplayFor "title")}}
          >
          <ValidationError @errors={{get-errors-for this.title}} />
        </EditableField>
      {{/if}}
    </h2>
    <div class="actions">
      <button
        type="button"
        disabled={{this.downloadReport.isRunning}}
        {{on "click" (perform this.downloadReport)}}
        data-test-download
      >
        {{#if this.finishedBuildingReport}}
          <FaIcon @icon="check" />
        {{else if this.downloadReport.isRunning}}
          <LoadingSpinner />
        {{else}}
          <FaIcon @icon="download" />
        {{/if}}
        {{t "general.downloadResults"}}
      </button>
    </div>
  </div>
  <div class="content-container">
    <div class="description" data-test-report-description>
      {{#if this.reportDescriptionLoaded}}
        {{this.reportDescription}}
      {{/if}}
    </div>
    {{#if this.showAcademicYearFilter}}
      <div class="years-filter">
        <select
          aria-label={{t "general.academicYears"}}
          data-test-year-filter
          {{on "change" (pick "target.value" @onReportYearSelect)}}
        >
          <option selected={{is-empty @selectedYear}} value="">
            {{t "general.allAcademicYears"}}
          </option>
          {{#each
            (sort-by
              "title:desc" this.allAcademicYears
            ) as |year|
          }}
            <option
              value={{year.id}}
              selected={{eq year.id @selectedYear}}
            >
              {{year.title}}
            </option>
          {{/each}}
        </select>
      </div>
    {{/if}}
    <this.subjectComponent
      @report={{@selectedReport}}
      @year={{@selectedYear}}
    />
  </div>
</section>
