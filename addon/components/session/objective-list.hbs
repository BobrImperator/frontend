<div
  class="session-objective-list"
  data-test-session-objective-list
  {{did-insert (perform this.load) @session @session.objectives}}
  {{did-update (perform this.load) @session @session.objectives}}
>
  {{#if (is-array this.objectives)}}
    {{#if this.isSorting}}
      <ObjectiveSortManager
        @subject={{@session}}
        @save={{perform this.saveSortOrder}}
        @cancel={{set this.sorting false}}
      />
    {{else if this.objectives.length}}
      {{#if (and @editable this.hasMoreThanOneObjective)}}
        <button
          type="button"
          {{on "click" (fn (mut this.isSorting) true)}}
          data-test-sort
        >
          {{t "general.sortObjectives"}}
        </button>
      {{/if}}
      <table>
        <thead>
          <tr>
            <th class="text-left" colspan="3">
              {{t "general.description"}}
            </th>
            <th class="text-left" colspan="2">
              {{t "general.parentObjectives"}}
            </th>
            <th class="text-left" colspan="2">
              {{t "general.meshTerms"}}
            </th>
            <th class="text-left" colspan="1">
              {{t "general.actions"}}
            </th>
          </tr>
        </thead>
        <tbody>
          {{#each this.objectives as |objective|}}
            <Session::ObjectiveListItem
              @objective={{objective}}
              @editable={{@editable}}
              @session={{this.session}}
              @showRemoveConfirmation={{contains
                objective.id
                this.objectivesForRemovalConfirmation
              }}
              @remove={{this.confirmRemoval}}
              @manageParents={{@manageParents}}
              @manageDescriptors={{@manageDescriptors}}
            />
            {{#if (contains objective.id this.objectivesForRemovalConfirmation)}}
              <tr class="confirm-removal">
                <td colspan="8">
                  <div class="confirm-message">
                    {{t "general.confirmObjectiveRemoval"}}
                    <br>
                    <div class="confirm-buttons">
                      <button
                        class="remove text"
                        type="button"
                        {{on "click" (perform this.deleteObjective objective)}}
                      >
                        {{t "general.yes"}}
                      </button>
                      <button
                        class="done text"
                        type="button"
                        {{on "click" (fn this.cancelRemove objective)}}
                      >
                        {{t "general.cancel"}}
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
            {{/if}}
          {{/each}}
        </tbody>
      </table>
    {{/if}}
  {{else}}
    {{! template-lint-disable no-unused-block-params }}
    {{#each (repeat (has-many-length @session "objectives")) as |empty|}}
      <div>
        <LoadingSpinner />
      </div>
    {{/each}}
  {{/if}}
</div>
{{#if this.saveSortOrder.isRunning}}
  <WaitSaving
    @showProgress={{true}}
    @totalProgress={{this.totalObjectivesToSave}}
    @currentProgress={{this.currentObjectivesSaved}}
  />
{{/if}}
